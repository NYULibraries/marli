machine:
  services:
    - docker

dependencies:
  override:
    - docker-compose version
    - docker-compose up -d

database:
  override:
    - docker-compose run web rake db:create
    - docker-compose run -e RAILS_ENV=test web rake db:schema:load

test:
  override:
    - docker-compose run -e RAILS_ENV=test web rake

deployment:
  production:
    branch: master
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/MaRLI/job/MaRLI%20Production%20Deploy/build/api
  development:
    branch: /.+/
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/MaRLI/job/MaRLI%20Development%20Deploy/build/api
