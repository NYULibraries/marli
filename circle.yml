machine:
  services:
    - docker

dependencies:
  override:
    - docker-compose version
    - docker-compose up -d
    - docker-compose run web rake db:create
    - docker-compose run -e RAILS_ENV=test web rake db:schema:load

database:
  override:
    - echo "Database running in docker..."

test:
  override:
    - docker-compose run -e RAILS_ENV=test -e CI=$CI -e CODECLIMATE_REPO_TOKEN=$CODECLIMATE_REPO_TOKEN -e COVERALLS_REPO_TOKEN=$COVERALLS_REPO_TOKEN web rake
