machine:
  services:
    - docker

dependencies:
  override:
    - docker-compose version
    - docker-compose -f config/docker/docker-compose.test.yml up -d
    - docker-compose -f config/docker/docker-compose.test.yml run web rake db:create
    - docker-compose -f config/docker/docker-compose.test.yml run web rake db:schema:load

test:
  override:
    - echo $CI
    - echo $CODECLIMATE_REPO_TOKEN
    - echo $COVERALLS_REPO_TOKEN
    - docker-compose -f config/docker/docker-compose.test.yml run -e CI=$CI -e CODECLIMATE_REPO_TOKEN=$CODECLIMATE_REPO_TOKEN -e COVERALLS_REPO_TOKEN=$COVERALLS_REPO_TOKEN web rake

database:
  override:
    - echo "Database running in docker..."
